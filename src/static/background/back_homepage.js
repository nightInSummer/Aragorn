!function(){function v(){w(),y(),A(),B(),E(),I(),D(i.offsetWidth,i.offsetHeight),F()}function w(){r=new FSS.WebGLRenderer,s=new FSS.CanvasRenderer,t=new FSS.SVGRenderer,x(f.renderer)}function x(a){switch(m&&k.removeChild(m.element),a){case c:m=r;break;case d:m=s;break;case e:m=t}m.setSize(i.offsetWidth,i.offsetHeight),k.appendChild(m.element)}function y(){n=new FSS.Scene}function A(){n.remove(o),m.clear(),p=new FSS.Plane(a.width*m.width,a.height*m.height,a.slices),q=new FSS.Material(a.ambient,a.diffuse),o=new FSS.Mesh(p,q),n.add(o)}function B(){m.clear(),light=new FSS.Light(b.ambient,b.diffuse),light.ambientHex=light.ambient.format(),light.diffuseHex=light.diffuse.format(),light.setPosition(b.xPos,b.yPos,b.zOffset),n.add(light),b.proxy=light,b.pickedup=!0,b.currIndex++}function C(a){b.proxy=n.lights[a-1];var c=n.lights.length-1;for(l=a;l>=c;l--)light=n.lights[l],n.remove(light);m.clear()}function D(a,b){m.setSize(a,b),FSS.Vector3.set(h,m.halfWidth,m.halfHeight),A()}function E(){var d,a=function(a,b){var f,g,c=[],d=[a[0]*m.width-m.width/2,m.height/2-a[1]*m.height],e=[b[0]*m.width-m.width/2,m.height/2-b[1]*m.height];for(f=1,g=30;g>=f;f++)c.push([(f*d[0]+(g-f)*e[0])/g,(f*d[1]+(g-f)*e[1])/g]);return c},c=a([.4,1],[0,0]).concat(a([.8,.2],[.4,1])).concat(a([.5,.5],[.8,.2]));b.pickedup&&c.forEach(function(a,c){setTimeout(function(){b.xPos=a[0],b.yPos=a[1],b.proxy.setPosition(b.xPos,b.yPos,b.proxy.position[2])},70*c)}),setTimeout(function(){d=setInterval(function(){var a=b.proxy.position[2]+3;b.proxy.setPosition(b.proxy.position[0],b.proxy.position[1],a),b.zOffset=a},100)},70*c.length-70),setTimeout(function(){clearInterval(d)},70*c.length+1700),setTimeout(function(){document.getElementById("title").style.display="block"},70*c.length+500),setTimeout(function(){document.getElementById("subtitle").style.display="block",document.getElementById("nav").style.display="block",document.getElementById("bottomarrow").style.display="block",H()},70*c.length+2e3)}function F(){G(),requestAnimationFrame(F)}function G(){m.render(n)}function H(){window.addEventListener("resize",K),i.addEventListener("mousemove",L)}function I(){var h,i,q;u=new dat.GUI({autoPlace:!1}),j.appendChild(u.domElement),renderFolder=u.addFolder("Render"),meshFolder=u.addFolder("Mesh"),lightFolder=u.addFolder("Light"),exportFolder=u.addFolder("Export"),lightFolder.open(),q=renderFolder.add(f,"renderer",{webgl:c,canvas:d,svg:e}),q.onChange(function(a){x(a)}),q=meshFolder.addColor(a,"ambient"),q.onChange(function(a){for(h=0,i=n.meshes.length;i>h;h++)n.meshes[h].material.ambient.set(a)}),q=meshFolder.addColor(a,"diffuse"),q.onChange(function(a){for(h=0,i=n.meshes.length;i>h;h++)n.meshes[h].material.diffuse.set(a)}),q=meshFolder.add(a,"width",.05,2),q.onChange(function(a){p.width!==a*m.width&&A()}),q=meshFolder.add(a,"height",.05,2),q.onChange(function(a){p.height!==a*m.height&&A()}),q=meshFolder.add(a,"slices",1,800),q.step(1),q.onChange(function(a){p.slices!==a&&A()}),q=lightFolder.add(b,"currIndex",{1:1,2:2,3:3,4:4,5:5,6:6,7:7}).name("Current light").listen(),q.onChange(function(a){b.proxy=n.lights[a-1],b.ambient=b.proxy.ambient.hex,b.diffuse=b.proxy.diffuse.hex,b.xPos=b.proxy.position[0],b.yPos=b.proxy.position[1],b.zOffset=b.proxy.position[2]}),q=lightFolder.addColor(b,"ambient").listen(),q.onChange(function(a){b.proxy.ambient.set(a),b.proxy.ambientHex=b.proxy.ambient.format()}),q=lightFolder.addColor(b,"diffuse").listen(),q.onChange(function(a){b.proxy.diffuse.set(a),b.proxy.diffuseHex=b.proxy.ambient.format()}),q=lightFolder.add(b,"count",1,7).listen(),q.step(1),q.onChange(function(a){n.lights.length!==a&&(a>n.lights.length?B():C(a))}),q=lightFolder.add(b,"xPos",-o.geometry.width/2,o.geometry.width/2).listen(),q.step(1),q.onChange(function(a){b.proxy.setPosition(a,b.proxy.position[1],b.proxy.position[2])}),q=lightFolder.add(b,"yPos",-o.geometry.height/2,o.geometry.height/2).listen(),q.step(1),q.onChange(function(a){b.proxy.setPosition(b.proxy.position[0],a,b.proxy.position[2])}),q=lightFolder.add(b,"zOffset",0,1e3).name("Distance").listen(),q.step(1),q.onChange(function(a){b.proxy.setPosition(b.proxy.position[0],b.proxy.position[1],a)}),q=exportFolder.add(g,"width",100,3e3),q.step(100),q=exportFolder.add(g,"height",100,3e3),q.step(100),q=exportFolder.add(g,"export").name("export big"),q=exportFolder.add(g,"exportCurrent").name("export this")}function J(a){var b=document.getElementById(a);b.style.display="block"==b.style.display?"none":"block"}function K(){D(i.offsetWidth,i.offsetHeight),G()}function L(a){b.pickedup&&(b.xPos=a.x-m.width/2,b.yPos=m.height/2-a.y,b.proxy.setPosition(b.xPos,b.yPos,b.proxy.position[2]))}var m,n,o,p,q,r,s,t,u,a={width:1.2,height:1.2,slices:250,ambient:"#555555",diffuse:"#FFFFFF"},b={count:1,xPos:-670,yPos:304,zOffset:80,ambient:"#000000",diffuse:"#FF8800",pickedup:!0,proxy:!1,currIndex:0},c="webgl",d="canvas",e="svg",f={renderer:c},g={width:2e3,height:1e3,exportCurrent:function(){var a,b;switch(f.renderer){case c:window.open(r.element.toDataURL(),"_blank");break;case d:window.open(s.element.toDataURL(),"_blank");break;case e:a=encodeURIComponent(k.innerHTML),b="data:image/svg+xml,"+a,window.open(b,"_blank")}},"export":function(){var b,g,h,j,q,t,l=this.width/m.width,o=this.height/m.height,p=a.slices;for(a.slices=Math.ceil(1.3*p*l),D(this.width,this.height),a.slices=p,b=n.lights.length-1;b>=0;b--)j=n.lights[b],g=j.position[0],h=j.position[1],z=j.position[2],FSS.Vector3.set(j.position,g*l,h*o,z*l);switch(G(),f.renderer){case c:window.open(r.element.toDataURL(),"_blank");break;case d:window.open(s.element.toDataURL(),"_blank");break;case e:q=encodeURIComponent(k.innerHTML),t="data:image/svg+xml,"+q,window.open(t,"_blank")}for(D(i.offsetWidth,i.offsetHeight),b=n.lights.length-1;b>=0;b--)j=n.lights[b],g=j.position[0],h=j.position[1],z=j.position[2],FSS.Vector3.set(j.position,g/l,h/o,z/l)}},h=FSS.Vector3.create(),i=document.getElementById("aragorn-background"),j=document.getElementById("aragorn-background-controls"),k=document.getElementById("aragorn-background-output");Mousetrap.bind("ctrl+backspace",function(){J("aragorn-background-controls")}),Mousetrap.bind("shift+enter",function(){b.count++,B()}),Mousetrap.bind("shift+backspace",function(){var a=b.count-1;n.lights.length!==a&&a>0&&(b.count=a,C(a))}),Mousetrap.bind("shift+s",function(){b.pickedup=!b.pickedup}),v()}();